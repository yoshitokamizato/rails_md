# Webアプリケーションとは
WEBアプリケーションとは、ブラウザから利用可能な動的なWebサービスのことを指します。 動的Webサービスとは何かというと、ユーザーの利用状況によって柔軟に画面や表示内容が変わるサービスのことです。例えば、会社のホームページとFacebookやTwitterなどを比べてみるとよくわかるかとお思います。会社のホームページは何度訪れても画面になんの変化もありません。それに対し、FacebookやTwitterはユーザの登録情報や投稿内容によってまったく表示が異なります。このように、動的に変化するのがWebアプリケーションの特徴です。

# リクエストとレスポンス
Webアプリケーションでは、リクエストとレスポンスという概念が存在します。`リクエスト`はユーザーからの要求のことで、ボタンをクリックしたり、URLを入力してアクセスしたときにリクエストが発生します。`レスポンス`はアプリの応答のことで、ユーザーが要求したデータを表示するときにサーバーからレスポンスが送信されます。

- ユーザの要求 => リクエスト
- アプリの応答 => レスポンス

# Railsアプリの構成
Railsアプリの構成は、初心者にとってはかなり複雑な印象があるかと思います。でも、きちんと以下の構成になっていることを頭に入れておけば、この後の学習もだいぶスムーズになるので、よく確認して見てください。

- Rails（アプリの本体）
 - ルート
 - コントローラ
 - モデル
 - ビュー
- データベース（MySQL, Postgre, SQLiteなど）

# 今回作成するアプリ
今回作成するのは、`Hello World`を表示するだけの簡単なアプリです。このアプリを通して、ルート・コントローラ・ビューの作成方法をしっかりと身につけましょう。このレッスンの内容が、これからRailsアプリケーションを作成するための土台となります。大切な部分なので、一つ一つ確認しながら進めていってください。

## 実装する機能
- ユーザー登録
- ユーザー一覧表示
- ユーザー情報の更新
- ユーザーの削除

# Railsアプリの処理の順番
Railsアプリにユーザーからアクセスがあった場合、アプリ内で以下のように処理されます。

1. リクエスト：ユーザーからのリクエスト
2. ルート：コントローラのアクションを指定
3. コントローラ：モデルやビューへの処理の振り分け
4. ビュー：画面の表示

# アプリ立ち上げの流れ
慣れないうちは、アプリを立ち上げたら以下の流れで初期画面が表示されるか確認してください。

1. `rails new`コマンド
2. `rake db:create`（データベースの作成）
3. `rails s`（サーバを立ち上げ）
4. [http://localhost:3000/](http://localhost:3000/)にアクセス

データベースの種類を指定してアプリを立ち上げる時は、以下のようにコマンドを実行します。

例）`sample`という名前のアプリを作成する

```
rails new sample
```

# データベースを作成する
アプリを立ち上げることができたら、新しくディレクトリができています。ディレクトリとは、パソコンでよく利用するフォルダと同じだと思っていただいて大丈夫です。プログラミングの世界では、フォルダのことをディレクトリと表現します。

では、立ち上げたアプリのディレクトリに移動しましょう。今回は、`sample`という名前のアプリを作成したので、`sample`ディレクトリが作成されているかと思います。その中に移動する時は、以下のコマンドを実行します。

```
cd sample
```

`cd sample`の`cd`は、`change directory`という意味になります。つまり、使用するディレクトリを変更するということですね。このように、どういう単語の略なのかを考えると、コマンドもだいぶ覚えやすくなります。

アプリのディレクトリに移動できたら、次はアプリに対応するデータベースを作成しましょう。データベースを作成すると言っても、そこまで難しく考える必要はありません。短いコマンドを実行するだけで、簡単にデータベースが作成できます。

# データベースの作成
データベースとは、Webアプリケーションの中で使用されるデータを整理整頓し、管理するためのものです。立ち上げたアプリに関連するデータベースを作成する場合は、以下のコマンドを実行するだけでOKです。

```
bundle exec rake db:create
```

また、このコマンドは一度実行した後は再度実行する必要はありません。すでにデータベースが作成されたアプリでは、すでにデータベースを使える準備ができているので、最初の一回だけ実行するようにしましょう。（もし実行してもエラーが表示されるだけでアプリが壊れることはありません）

アプリを作成したら、Webサーバを起動しましょう。RailsアプリはWebアプリケーションなので、Webサーバーが起動していないと動作を確認することができません。そのため、以下のコマンドを実行してWebサーバーを立ち上げましょう。ちなみに、Railsに付属しているWebサーバーは`WEBrick`と呼ばれています。

```
rails s
```

サーバーが起動できたら、初期画面へアクセスしてみましょう。以下のリンクから、初期画面へアクセスすることができます。

[http://localhost:3000/](http://localhost:3000/)


# MVCモデルの理解
`MVCモデル`は、Railsアプリを開発する上でとても重要な概念です。MVCというアルファベットのそれぞれの意味は以下の通りです。ちょっと難しい部分なので、今はさらっと読んでおくだけで大丈夫です。

|頭文字|読み|役割|
|---|---|---|
|M|モデル|データベースとのデータのやり取り、複雑なロジックを記述、バリデーションの設定|
|V|ビュー|ユーザーの目に触れる部分|
|C|コントローラ|処理の振り分け|

MVCモデルでは、以上のようにプログラムが明確に役割分担されています。それによって、コードの管理、運用保守が簡単に行えるようにしています。例えば、プログラミングのわからないデザイナーでもビューの部分だけなら編集ができるようになったり、処理の振り分けを変えたいならコントローラの部分の記述だけを変えたりと、どこのコードを編集すればいいかを明確にできたり、一部のコードを変更しても他の部分のコードの変更が最小限に抑えられるようになるのです。


# Railsアプリ開発の流れ
Railsアプリを開発する時は、以下の流れで行います。今後ずっと行うことになる重要な流れなので、ぜひしっかりと頭に入れておいてください。

1. ルートを作成
2. コントローラを作成
3. ビューを作成

とにかく、ルート・コントローラ・ビューの順番で設定を行うということを頭に入れておいてください。これがRailsアプリ開発の超重要な手順になります。

## ルートの作成
では早速、手順1のルートの作成から始めていきましょう。まずはファイルのある場所をしっかりと覚えてください。ルートを設定するためのファイルは`config`ディレクトリの中にあります。

```
config/routes.rb
```

ファイルが確認できたら、その中にルートを設定しましょう。ルートを設定する際は、`アクセスされるURL`、`そのURLに対応するコントローラ`、`指定したコントローラのアクション`を記述します。以下は、ルートを設定するときの一つの例です。

```ruby
# 左側がURL　右側がコントローラの名前とアクション
get '/users', to: 'users#index'
```

上の例は以下のような構成になっています。

```
HTTPリクエスト 'ユーザーが指定するURL', to: 'コントローラー名#アクション名'
```

これが基本的な書き方なので、ぜひ頭に入れておいてください。また、ここで出てきたHTTPリクエストには以下のような種類があります。

# コントローラの作成
先ほど、ルートの設定の部分で以下のように記述しました。

```ruby
# 左側がURL　右側がコントローラの名前とアクション
get '/users', to: 'users#index'
```

このとき、ユーザーが`/users`にアクセスすると、`users`コントローラの`index`アクションに処理が移るということになります。そのため、次は`users`コントローラを作成し、その中に`index`アクションを追加しましょう。

まずは、コントローラを作成するために以下のコマンドをターミナルで実行します。

```
rails g controller users
```

上のコードの構成は以下のようになります。`controller_name`の部分には、自分が作成したいコントローラ名を入力してください。また、Railsのルールとして、コントローラ名(`controller_name`の部分)は複数形にすることが推奨されます。

```
rails g controller controller_name
```

`rails g controller users`を実行すると、以下の場所に`users_controller.rb`というコントローラのファイルができています。テキストエディタから、以下のファイルが作成されているか確認してみましょう。

```
app/controller/users_controller.rb
```

コントローラが作成できたら、次にアクションを追加します。ルートの設定の部分で`users`コントローラに対して`index`アクションを指定したので、ファイルの中に`index`アクションを定義します。以下のようにコードを書いてみましょう。

```ruby
  # indexがアクション名
  def index

  end
```

上の記述がアクションの基本的な設定方法になります。基本的な構成として`def`と`end`で囲み、ルートの指定に対応するアクション名を定義してあげます。

```ruby
  def アクション名

  end
```

# ビューの作成
コントローラのアクションが定義できたら、そのアクションに対応するビューを作成しましょう。ビューファイルは以下の場所で管理されています。

```
app/views
```

その中に、デフォルトで`layouts`というディレクトリが存在します。また、そのほかにも`users`というディレクトリが存在するかと思います。このディレクトリは、先ほど`rails g controller users`というコマンドを実行した時に作成されたものです。つまり、コントローラを作成すると、それに対応するビューのディレクトリも一緒に作成されるということです。

ビューファイルは、コントローラのアクションに対応する名前にします。今回のサンプルであれば、`users`コントローラの`index`アクションに対応するビューファイルを作成するので、`app/views/users`の中に`index.html.erb`というファイルを作成します。

コントローラに関してはターミナルからコマンドで作成しましたが、ビューはテキストエディタから直接ファイルを作成しましょう。`users`ディレクトリで右クリックし、`New File(テキストエディタによって表示が異なる)`を選択してファイルを作成し、`名前をつけて保存`で`index.html.erb`と入力して保存をしましょう。

```
index.html.erb
```

上の記述の中で、`.html.erb`の部分は拡張子 となります。これはRails特有の拡張子で、`erb`は`embedded ruby`という意味になるます。`embedded`という単語が「埋め込まれた」という意味なので、「HTMLの中にrubyを埋め込むことができる」ということになります。

では、さっそく作成したビューファイルにHTMLの`h1`タグで`Hello World`を表示するコードを書いてみましょう。

``` 
<h1>Hello World!!</h1>
```

HTMLを書いたら、ターミナルからサーバーを立ち上げ、実際に画面に`Hello World!!`が表示されるか確かめます。サーバーを立ち上げるには、以下のコマンドを実行します。

```
rails s
```

コマンドを実行したら、以下のURLにアクセスしましょう。`Hello World!!`が表示されていれば成功です。

[http://localhost:3000/](http://localhost:3000/)

# 最後に
これで今回作成するアプリが完成したわけですが、最後にもう一つ、Railsを理解する上で重要な部分をご説明します。実は、Railsでは`views/layouts`の中に`application.html.erb`というファイルがあり、それがWeb上に画面を表示する際のテンプレートとなっています。`application.html.erb`は、アプリを作成した直後は以下のような状態になっています。

```html
<!DOCTYPE html>
<html>
<head>
  <title>ControllerTest</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
</head>
<body>

<%= yield %>

</body>
</html>
```

この`application.html.erb`のコードの中で注目していただきたいのが、`<%= yield %>`の部分です。実は、先ほど`Hello World!!`を表示した際、この`<%= yield %>`の部分が`index.html.erb`の内容と置き換わって表示されていたのです。つまり、イメージとしては以下のようになります。

```html
<!DOCTYPE html>
<html>
<head>
  <title>ControllerTest</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
</head>
<body>

<!-- yieldがindex.html.erbの内容と置き換わる -->
<h1>Hello World!!</h1>

</body>
</html>
```

以上をまとめると、以下のような流れでユーザーのリクエストが処理されます。

1. ユーザーがリクエストを送信する（URLにアクセス）
2. ルートによりURLに対応するコントローラのアクションに処理が移る
3. コントローラのアクションに対応するビューが表示される
 - ただし対応するビューが直接表示されるのではなく`layout`の`yield`がユーザーのリクエストに対応したビューと置き換わる

最初は混乱するかも知れませんが、ルート・コントローラ・ビューの実装を繰り返したり、サンプルコードをもとに自分なりにカスタマイズしてコードを書いていくうちに理解できるようになっていきます。ためしに、`index.html.erb`とは別に、`new.html.erb`を作成し、そのビューファイルが表示されるようにルート・コントローラ・ビューを編集して見ましょう。

# 練習問題
以下の問題を一つ一つ解いてみてください。

```
usersコントローラのnewアクションに処理が遷移するルートを定義してください。
```

```
usersコントローラにnewアクションを追加してください。
```

```
newアクションに対応するviewファイルを作成し、「Good morning!!」が表示されるようにしてください。
```
